<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.ict.ex.mapper.EmpMapper">
	<select id="getList" resultType="edu.ict.ex.vo.EmpVO">
		select * from emp
	</select>
	<!-- INSERT INTO EMP VALUES (1111,'홍길동','CLERK',7369,'2024-09-24', 800,8000,10) -->
	<insert id="insert">
		INSERT INTO EMP VALUES
		(#{empno},#{ename},#{job},#{mgr},#{hiredate2},
		#{sal},#{comm},#{deptno})
	</insert>

	<select id="getTotalCount" resultType="int">
		 <![CDATA[
			select count(*) from emp
		 ]]>
	</select>

	<select id="getListWithPaging" resultType="EmpVO">
		 <![CDATA[
			        SELECT * FROM (
              SELECT ROWNUM AS RNUM, A.* FROM (
                          SELECT *  FROM emp order by empno
                ) A WHERE ROWNUM <= #{pageNum} * #{amount}
         ) WHERE RNUM > (#{pageNum}-1) * #{amount}
		 ]]>
	</select>

	<resultMap id="empMap" type="EmpVO">
		<id property="empno" column="empno" />
		<result property="ename" column="ename" />
		<result property="job" column="job" />
		<result property="mgr" column="mgr" />
		<result property="hiredate" column="hiredate" />
		<result property="sal" column="sal" />
		<result property="comm" column="comm" />
		<result property="deptno" column="deptno" />
	</resultMap>

	<resultMap id="deptMap" type="DeptEmpVO">
		<result property="deptno" column="deptno" />
		<result property="dname" column="dname" />
		<result property="loc" column="loc" />
		<collection property="empList" resultMap="empMap"></collection>
	</resultMap>

	<resultMap id="salgradeMap" type="SalgradeVO">
		<result property="garde" column="garde" />
		<result property="losal" column="losal" />
		<result property="hisal" column="hisal" />
		<collection property="empList" resultMap="empMap"></collection>
	</resultMap>


	<!-- 절대 resultType 으로 하지 말것 -->
	<select id="getDeptEmpList" resultMap="deptMap">
       <![CDATA[
             select * from emp, dept where emp.deptno = dept.deptno
        ]]>
	</select>

	<select id="getDeptSalgradeList" resultMap="empsalMap">
       <![CDATA[
           SELECT E.ENAME, E.JOB, D.DNAME, E.SAL, S.GRADE
				FROM EMP E, DEPT D, SALGRADE S
				WHERE E.DEPTNO=D.DEPTNO
				AND E.SAL BETWEEN S.LOSAL AND S.HISAL  
        ]]>
	</select>

	  <!-- EMP DEPT 일대일 매핑 -->
    
   <resultMap id="deptOneMap" type="DeptVO">
        <result property="deptno" column="deptno"/>
       <result property="loc" column="loc"/>
       <result property="dname" column="dname"/>    
   </resultMap>
    
   <resultMap id="empDeptMap" type="EmpDeptVO" >
       <id property="empno" column="empno"/>
       <result property="ename" column="ename"/>
       <result property="job" column="job"/>
       <result property="mgr" column="mgr"/>
       <result property="hiredate" column="hiredate"/>
       <result property="sal" column="sal"/>
       <result property="comm" column="comm"/>
       <result property="deptno" column="deptno"/>
       <association property="dept" resultMap="deptOneMap"></association>
   </resultMap>
   
   	<!-- 절대 resultType 으로 하지 말것 -->
	<select id="getEmpOneDeptList" resultMap="empDeptMap">
       <![CDATA[
             select * from emp, dept where emp.deptno = dept.deptno
        ]]>
	</select>
	
	<resultMap id="empGradeMap" type="SalgradeVO">
		<result property="grade" column="grade" />
		<result property="losal" column="losal" />
		<result property="hisal" column="hisal" />
	</resultMap>
	
	<resultMap id="empsalMap" type="EmpGradeVO" >
       <id property="empno" column="empno"/>
       <result property="ename" column="ename"/>
       <result property="job" column="job"/>
       <result property="mgr" column="mgr"/>
       <result property="hiredate" column="hiredate"/>
       <result property="sal" column="sal"/>
       <result property="comm" column="comm"/>
       <result property="deptno" column="deptno"/>
       <association property="salgrade" resultMap="empGradeMap"></association>
   </resultMap>
	
	<select id="getEmpSalgradeList" resultMap="empsalMap">
       <![CDATA[
             SELECT * FROM EMP e, SALGRADE s WHERE e.SAL BETWEEN s.LOSAL AND s.HISAL
        ]]>
	</select>
	
		<resultMap id="deptGradeMap" type="SalgradeVO">
		<result property="grade" column="grade" />
		<result property="losal" column="losal" />
		<result property="hisal" column="hisal" />
		<collection property="depts" resultMap="deptempMap"></collection>
	</resultMap>
	
	<resultMap id="deptempMap" type="DeptVO">
		<result property="deptno" column="deptno" />
		<result property="dname" column="dname" />
		<result property="loc" column="loc" />		
	</resultMap>
	
	<resultMap id="deptsalMap" type="EmpGradeVO" >
       <id property="empno" column="empno"/>
       <result property="ename" column="ename"/>
       <result property="job" column="job"/>
       <result property="mgr" column="mgr"/>
       <result property="hiredate" column="hiredate"/>
       <result property="sal" column="sal"/>
       <result property="comm" column="comm"/>
       <result property="deptno" column="deptno"/>
       <association property="salgrade" resultMap="deptGradeMap"></association>
   </resultMap>
	
	<select id="getDeptEmpSalgradeList" resultMap="deptsalMap">
       <![CDATA[
             SELECT E.ENAME, E.JOB, D.DNAME, E.SAL, S.GRADE
				FROM EMP E, DEPT D, SALGRADE S
				WHERE E.DEPTNO=D.DEPTNO
				AND E.SAL BETWEEN S.LOSAL AND S.HISAL 
        ]]>
	</select>

</mapper>